<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>장바구니 공유 서비스, 동상이물</title>
    <link href="../static/css/login.css"
          th:href="@{/css/login.css}"
          rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script th:inline="javascript">

        function nameCheck(){
            var form = document.joinForm;
            var name = document.getElementById("name").value;
            if(!form.name.value){
                alert("사용하실 닉네임을 입력해주세요.");
                form.name.focus();
                return;
            }
            $.ajax({
                type: "POST",
                url: "/v1/members/inquiry",
                data : {"name" : name, "password" : password},

                success: function (result) {
                    if(result == "non_existent"){
                        alert("존재하지 않는 회원입니다.");

                        $('.info_id_box').attr("check_result","success");
                        form.name.focus();
                    } else {
                        alert(name + ": 이미 사용중인 이름입니다.\n다른 이름을 사용해주세요.");
                        form.name.focus();
                    }
                },
                error: function(request, status){
                    alert(" 중복확인 실패 \n code:" + request.status);
                }
            });
        }

        function ttest(){
            var form = document.loginForm;
            var name = document.getElementById("name").value;
            var password = document.getElementById("password").value;

            if(name != "test"){
                alert("name is not test");
                form.name.focus();
                return false;
            } else {
                return true;
            }
        }

        var checked = "unchecked";
        var response = "unchecked";

        function inquiry(){
            var form = document.loginForm;
            var name = document.getElementById("name").value;
            var password = document.getElementById("password").value;

<!--            $.ajax({-->
<!--                type: "POST",-->
<!--                url: "/v1/members/inquiry",-->
<!--                data : {"name" : name, "password" : password},-->

<!--                success: function(result.result){-->
<!--                    response = result;-->
<!--                    checked = "checked";-->

<!--                    if(result == "non_existent"){-->
<!--                        alert(name + ": 조회되지 않는 회원입니다.");-->
<!--                        form.name.focus();-->
<!--                        return false;-->
<!--                    } else if(result == "wrong_password"){-->
<!--                        alert("비밀번호가 일치하지 않습니다.");-->
<!--                        form.password.focus();-->
<!--                        return false;-->
<!--                    } else { return true; }-->
<!--                },-->
<!--                error: function(request, status){-->
<!--                    alert("code: "+request.status+"\n로그인에 실패했습니다. 잠시후 다시 시도해주세요.");-->
<!--                }-->
<!--            });-->

            if(checked == "checked"){
                login();
            }
        }

        function login(){
            if(response == "non_existent"){
                    alert("일치하는 회원이 존재하지 않습니다.");
                    form.name.focus();
                    return false;
                } else if(result == "wrong_password"){
                    alert("비밀번호가 일치하지 않습니다.");
                    form.password.focus();
                    return false;
                } else {
                    return true;
                }
        }

<!--        function nlogin(){-->
<!--            var form = document.loginForm;-->
<!--            var name = document.getElementById("name").value;-->
<!--            var password = document.getElementById("password").value;-->
<!--            var response = "false";-->

<!--            $.ajax({-->
<!--                type: "POST",-->
<!--                url: "/v1/members/booleaninquiry",-->
<!--                data : {"name" : name, "password" : password},-->

<!--                success: function(result){-->
<!--                    if(result == false){-->
<!--                        alert("아이디 또는 비밀번호가 일치하지 않습니다.");-->
<!--                        response = "false";-->
<!--                    } else { response = "true"; }-->
<!--                },-->
<!--                error: function(request, status){-->
<!--                    alert("code: "+request.status+"\n로그인에 실패했습니다. 잠시후 다시 시도해주세요.");-->
<!--                }-->
<!--            });-->

<!--            if(response == "false"){-->
<!--                alert("아이디 또는 비밀번호가 일치하지 않습니다.");-->
<!--                return false;-->
<!--            } else {-->
<!--                return true;-->
<!--            }-->

<!--            $.ajax({-->
<!--                type: "POST",-->
<!--                url: "/v1/members/inquiry",-->
<!--                data : {"name" : name, "password" : password},-->

<!--                success: function(result.result){-->
<!--                    if(result == "non_existent"){-->
<!--                        alert(name + ": 조회되지 않는 회원입니다.");-->
<!--                        form.name.focus();-->
<!--                        return false;-->
<!--                    } else if(result == "wrong_password"){-->
<!--                        alert("비밀번호가 일치하지 않습니다.");-->
<!--                        form.password.focus();-->
<!--                        return false;-->
<!--                    } else { return true; }-->
<!--                },-->
<!--                error: function(request, status){-->
<!--                    alert("code: "+request.status+"\n로그인에 실패했습니다. 잠시후 다시 시도해주세요.");-->
<!--                }-->
<!--            });-->
<!--        }-->

    </script>
</head>
<body>
<div class="background">
    <div class="wrapper">

        <div class="wrapper_blank"></div>

        <div class="wrapper_header">
            <div class="header_left">
                <span>동상이물</span>
            </div>
            <div class="header_right">
                <div class="header_button" id="header_button">
                    <span>Home</span>
                </div>
            </div>
        </div>

        <div class="wrapper_blank"></div>
        <div class="wrapper_blank"></div>

        <form class="wrapper_body"
              name = "loginForm"
              method="post"
              th:action
              action="v1/members/login"
              onsubmit="return ttest()"
              check_result="fail">
            <div class="sign_content">
                <div class="content_title">닉네임</div>
                <div class="content_input">
                    <input id="name" th:name="name" class ="info_box" type="text" placeholder="닉네임을 입력해주세요." required>
                </div>
            </div>

            <div class="sign_content">
                <div class="content_title">비밀번호</div>
                <div class="content_input">
                    <input id="password" th:name="password" class ="info_box" type="text" placeholder="비밀번호를 입력해주세요." required>
                </div>
            </div>

            <div class="form_buttons">
                <button class="sign_button" id="sign_button" type="submit">로그인</button>
                <button class="join_button" id="join_button" type="button"
                     onclick="location.href='join.html'"
                     th:onclick="|location.href='@{/v1/members/join}'|">회원가입</button>
            </div>
        </form>
    </div>
</div>
</body>
</html>